  name: Claude Issue Analyzer
  on:
    issues:
      types: [opened]

  jobs:
    analyze-issue:
      runs-on: ubuntu-latest
      timeout-minutes: 10
      permissions:
        contents: read
        issues: write
        id-token: write

      steps:
        - name: Checkout repository
          uses: actions/checkout@v4

        - name: Analyze issue with Claude
          uses: anthropics/claude-code-action@v1
          env:
            GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}
            allowed_non_write_users: "*"
            anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
            prompt: |
              Analyze this GitHub issue and check if it's a duplicate.

              Issue: ${{ github.repository }}/issues/${{ github.event.issue.number }}

              Steps:
              1. Use gh to view the issue details
              2. Search for similar issues
              3. Post a summary comment on the issue
            allowed_tools: "Bash(gh issue view:*),Bash(gh search:*),Bash(gh issue list:*),Bash(gh issue comment:*)"
